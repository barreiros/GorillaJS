#!/bin/bash -l

cp /root/templates/apache-vhost.conf /etc/apache2/sites-available/{{project.domain}}.conf && 
cd /var/www/{{project.domain}}

# Si no existe el archivo requirements.txt, a침ado uno por defecto.
if [ ! -e ./requirements.txt ]; then

    cp /root/templates/requirements.txt requirements.txt 

fi

# Instalo las dependencias.
pip install -r requirements.txt

# Si no existe el archivo manage.py, creo un nuevo proyecto.
if [ ! -e ./manage.py ]; then

    django-admin.py startproject {{project.slug}} . &&
    sed -i '/ALLOWED_HOSTS/c\ALLOWED_HOSTS = ["{{project.domain}}"]' ./{{project.slug}}/settings.py

fi

# Si no est치 configurado, a침ado la ruta para los archivos est치ticos.
if ! grep -q "STATIC_ROOT" ./{{project.slug}}/settings.py; then

    echo 'STATIC_ROOT = os.path.join(BASE_DIR, "static/")' >> ./{{project.slug}}/settings.py

fi

a2ensite {{project.domain}} && 
sudo a2dissite 000-default.conf && 
service apache2 start
